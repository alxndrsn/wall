<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

	<title>Wall</title>

	<!-- Bootstrap -->
	<link href="bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	<style>
		td { vertical-align:top; }
		.issue .media-body { vertical-align:middle; }
		.avatar {
			width: 48px;
			height: 48px;
			border-radius: 24px;
			-webkit-border-radius: 24px;
			-moz-border-radius: 24px;
			margin: 7px;
			background: url(http://link-to-your/image.jpg) no-repeat;
			box-shadow: 0 0 8px rgba(0, 0, 0, .8);
			-webkit-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
			-moz-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
		}
	</style>
	<link rel="shortcut icon" href="http://www.medicmobile.org/favicon.ico" id="favicon"></link>
</head>
<body>
	<div class="panel panel-default">
		<div class="panel-heading">Wall for <span class="repo-name"></span></div>
		<div class="panel-body">
			<div style="display:none" class="github-api alert alert-warning" role="alert">
				Your <a href="https://api.github.com/rate_limit">github API allowance</a> is running low...</div>
			<div style="display:none" class="github-api alert alert-danger" role="alert">
				Your <a href="https://api.github.com/rate_limit">github API allowance</a> has run out!</div>
		</div>
		<div id="wall-placeholder"></div>
	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="jquery/1.11.3/jquery.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src="lodash-compat/3.10.1/lodash.min.js"></script>
	<script src="js/string.js"></script>
	<script src="js/sanchez.js"></script>
	<script src="js/github.js"></script>
	<script src="js/wall.js"></script>

	<script id="issue" type="text/x-sanchez-template">
		<div class="issue media">
			<div class="media-left">
				<a href="{{user.url}}">
					<img class="avatar media-object" src="{{user.avatar_url}}" alt="{{user.login}}">
				</a>
			</div>
			<div class="media-body">
				<a href="{{url}}">
					<h4 class="media-heading">{{title}}</h4>
				</a>
			</div>
		</div>
	</script>

	<script id="table" type="text/x-sanchez-template">
		<table class="table"><thead><tr/></thead><tbody><tr/></tbody></table>
	</script>

	<script id="column-header" type="text/x-sanchez-template">
		<th class="col-md-{{columns}}">
			{{heading}} <span class="badge">0</span>
		</th>
	</script>

	<script id="repo-name-link" type="text/x-sanchez-template">
		<a class="repo-name" href="http://www.github.com/{{repo}}/issues">{{repo}}</a>
	</script>

	<script>
		var params = {}, repo, cols;
		location.search.substr(1).split('&').forEach(function(p) {
			var parts = p.split('=');
			params[parts[0]] = parts[1];
		});

		if(params.favicon) $('#favicon').attr('href', params.favicon);

		repo = params.repo || 'medic/medic-webapp';
		sanchez.replace('.panel-heading .repo-name', 'repo-name-link', { repo:repo });

		cols = params.cols ? JSON.parse(decodeURIComponent(params.cols)) : [
				'1 - Scheduled',
				'2 - Active Work',
				'3 - Acceptance testing',
				'4 - Ready' ];

		new Wall('#wall-placeholder', repo, cols);
		github.api_usage(function(usage) {
			var remaining = usage.rate.remaining;
			if(remaining < 4) {
				$('.github-api.alert-danger').show(200);
			} else if(remaining < 20) {
				$('.github-api.alert-warning').show(200);
			}
		});
	</script>
</body>
</html>
